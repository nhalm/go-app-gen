-- name: Create{{.DomainTitle}} :one
INSERT INTO {{.DomainPluralLower}} (
    name, 
    description,
    effective_start,
    effective_end
) VALUES (
    sqlc.arg('name'), 
    sqlc.arg('description'),
    COALESCE(sqlc.narg('effective_start'), NOW()),
    COALESCE(sqlc.narg('effective_end'), '9999-12-31 23:59:59Z')
)
RETURNING *;

-- name: Get{{.DomainTitle}} :one
SELECT * FROM {{.DomainPluralLower}}
WHERE id = $1 
  AND deleted_at IS NULL
  AND NOW() BETWEEN effective_start AND effective_end;

-- name: Get{{.DomainTitle}}ByID :one
SELECT * FROM {{.DomainPluralLower}}
WHERE id = $1 AND deleted_at IS NULL;

-- name: Update{{.DomainTitle}} :one
UPDATE {{.DomainPluralLower}}
SET 
    name = COALESCE(sqlc.narg('name'), name),
    description = COALESCE(sqlc.narg('description'), description),
    updated_at = NOW()
WHERE id = sqlc.arg('id')
  AND deleted_at IS NULL
RETURNING *;

-- name: SoftDelete{{.DomainTitle}} :exec
UPDATE {{.DomainPluralLower}}
SET 
    deleted_at = NOW(),
    updated_at = NOW()
WHERE id = $1 
  AND deleted_at IS NULL;

-- name: List{{.DomainTitle}}s :many
SELECT * FROM {{.DomainPluralLower}}
WHERE deleted_at IS NULL
ORDER BY created_at DESC;

-- name: Count{{.DomainTitle}}s :one
SELECT COUNT(*) FROM {{.DomainPluralLower}}
WHERE deleted_at IS NULL;